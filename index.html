<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>ICDV</title>
    <style type="text/css">
    #map {
        height: 70%;
    }
    
    html {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    </style>
</head>

<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
    <div id="map"></div>
    <script>
    function initMap() {
        var gm = {}; //儲存google map的所有物品
        var map = new google.maps.Map(document.getElementById("map"), {
                zoom: 8,
                center: {
                    lat: 23.58,
                    lng: 120.58
                }
            }) //新增一個google map
        gm.map = map;
        ArrayList = {}
        d3.csv("CompanyInfo-summary.csv", function(error, data) {
            var overlay = new google.maps.OverlayView();
            for (var i = 0; i < data.length; i++) {
                var county = data[i]["county"];
                var count = data[i]["count()"]
                ArrayList[county] = count
            }
            if (error) throw error;



        });
        var color = d3.scale.linear().domain([0, 200]).range(["#ffffff", "#FE0000"]);
        //console.log(color)
        $.getJSON("topojson/counties.json", function(data) {
            //console.log(data);
            geoJsonObject = topojson.feature(data, data.objects.map)
            map.data.addGeoJson(geoJsonObject);
            map.data.setStyle({
                icon: 'us.png',
                fillColor: '#000000'
            });
            map.data.setStyle(function(feature) {
                var ascii = feature["f"]["name"];
                
                var colors="#0C0A0A";
                if (typeof color(ArrayList[ascii]) != 'undefined') {
                	//console.log(typeof ArrayList[ascii])
                    colors = color(ArrayList[ascii]);
                }
                return {
                    fillColor: colors,
                    strokeWeight: 1,
                    icon: 'us.png',
                    visible: true
                };
            });
        });


    }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQ1uQe2aMilKakSvizaGAj5NHG-U4qz4U&callback=initMap">
    </script>
</body>

</html>
